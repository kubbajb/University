---
title: "Zadanie 2"
author: "Jakub Anczyk"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r lib, include=FALSE}
library(ggplot2)
library(nortest)
```

## Polecenie

Za pomoc odpowiednich symulacji zbada odsetek odrzuce prawdziwej hipotezy g贸wnej (tzn. bd I rodzaju) w tecie Komogorowa i tecie 2 w przypadku weryfikacji zgodnoci z rozkadem 2 o r贸偶nych stopniach swobody, tzn. generowa dane pochodzce z rozkadu 2 o  stopniach swobody i weryfikowa hipotez, 偶e dane maj rozkad 2 o  st. swobody. Nale偶y por贸wna wyniki klasycznego sposobu testowania i testowania z wykorzystaniem PIT (probability integral transform).

Uzyskane wyniki nale偶y przedstawi na odpowiednich wykresach ilustrujcych moce test贸w z
uwzgldnieniem:

- liczby danych,

- liczby stopni swobody generowanego rozkadu.

## Funkcje mierzce moc test贸w

```{r funkcje}

ks_n_df_power <- function(n,dgff){
  pvals <- c()
  for (j in 0:1000){
    data <- rchisq(n, df = dgff)
    p_value <- ks.test(x = data, df = dgff, "pchisq")$p.val
    pvals[j] <- (p_value > 0.05)
  }
  return (mean(pvals))
}

chisq_n_df_power <- function(n,dgff){
  pvals <- c()
  for (j in 0:1000){
    data <- rchisq(n, df = dgff)
    
    observed <- c()
    for(i in 0:max(data)){
      observed[i+1] <- sum(data >= i & data < i+1)
    }
    
    df <- dgff
    alpha <- 0.05 
    critical_value <- qchisq(1 - alpha, df)
    chi_squared <- sum((observed - mean(observed))^2 / mean(observed))
    p_value <- 1 - pchisq(chi_squared, df)
    pvals[j] <- (p_value > 0.05)
  }
  return (mean(pvals))
}
```

## Stworzenie danych dla test贸w

```{r dane}

data <- expand.grid(df=seq(2, 50,by=2), n=seq(5, 50,by=5))

```

## Zastosowanie funkcji do danych

```{r power}

data$ks_err_I <- mapply(ks_n_df_power, data$n, data$df)
data$chi_err_I <- mapply(chisq_n_df_power, data$n, data$df)

```

## Stworzenie wykres贸w do wygenerowanych danych

```{r charts}

(ks_err <- ggplot(data, aes(x = df, y = ks_err_I, color = as.factor(n))) +
  geom_line() +
  labs(x = "df", y = "power") +
  scale_color_manual(values = rainbow(10)) +
  labs(color = "n", title = "% bdu I rodzaju dla testu Koogomorowa-Smirnowa w zale偶noci od n i df") +
  geom_hline(yintercept = c(0.05), lty = 2))

(chi_err <- ggplot(data, aes(x = df, y = chi_err_I, color = as.factor(n))) +
  geom_line() +
  labs(x = "df", y = "power") +
  scale_color_manual(values = rainbow(10)) +
  labs(color = "n", title = "% bdu I rodzaju dla testu Chi-kwadrat w zale偶noci od n i df") +
  geom_hline(yintercept = c(0.05), lty = 2))
 
```