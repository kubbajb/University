---
title: "Zadanie 2"
author: "Jakub Anczyk"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r lib, include=FALSE}
library(ggplot2)
library(nortest)
```

## Polecenie

Za pomoc odpowiednich symulacji zbada wpyw liczby klas (na kt贸re dzielone s dane) na odsetek odrzuce prawdziwej hipotezy g贸wnej (tzn. bd I rodzaju) w tecie 2 w przypadku weryfikacji zgodnoci z rozkadem 2 o r贸偶nych stopniach swobody, tzn. generowa dane pochodzce z rozkadu 2 o  stopniach swobody i weryfikowa hipotez, 偶e dane maj rozkad 2 o  st. swobody.

Uzyskane wyniki nale偶y przedstawi na odpowiednich wykresach ilustrujcych rozmiary test贸w z uwzgldnieniem:

- liczby danych,

- liczby klas,

- liczby stopni swobody generowanego rozkadu.

## Funkcje mierzce moc test贸w

```{r funkcje}

chisq_p_val <- function(n, dgf, cuts){
  
  pvals <- c()

  # simulation loop
  for (j in 0:100){
    
    # sample data
    data <- rchisq(n = n, df = dgf)

    # division into bins
    lowest <- 0
    largest <- max(data)
    cut_points <- seq(lowest, largest, length.out = cuts)

    # calculate the theoretical probabilities of the values  
    pdf_probabilities <- dchisq(1:(length(cut_points)-1), dgf)
    pdf_probabilities <- c(pdf_probabilities,1-sum(pdf_probabilities))  

    # sample binning
    observed <- c()
    for (i in 0:length(cut_points)){
      observed[i] <- as.numeric(sum(data > cut_points[i] & na.omit(data <= cut_points[i+1])))
    }
    
    pval <- chisq.test(x = observed, p = pdf_probabilities)$p.value
    pvals[j] <- pval
  }
  return(mean(pvals))
}

```

## Stworzenie danych dla test贸w

```{r dane}

data <- expand.grid(n = c(5, 10, 15, 30, 40, 50), df = c(3, 4, 5, 6, 7, 8, 10, 15, 20, 30, 40), cuts = c(3, 5, 10, 15, 20))

```

## Zastosowanie funkcji do danych

```{r power, warning=FALSE}

data$avg_chisq_p_val <- mapply(chisq_p_val, data$n, data$df, data$cuts)

```

## Stworzenie wykres贸w do wygenerowanych danych

```{r charts}

(plot_avg_chisq_p_val <- ggplot(data, aes(x = df, y = avg_chisq_p_val, color = as.factor(n))) +
  geom_line() +
  labs(x = "df", y = "power") +
  scale_color_manual(values = rainbow(10)) +
  labs(color = "n", title = "% bdu I rodzaju dla testu Koogomorowa-Smirnowa w zale偶noci od n i df") +
  geom_hline(yintercept = c(0.05), lty = 2) +
  facet_wrap(~ cuts, nrow = 2))
 
```